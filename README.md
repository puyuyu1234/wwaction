# WWAction - TypeScript Edition

> **軽量・高速・テスト可能な2Dアクションゲームエンジン**
>
> Phaserのような重厚なフレームワークに頼らず、必要な機能だけを組み合わせた、テスト駆動開発が可能なゲームエンジン。

## 🎯 エレベーターピッチ

既存のJavaScriptゲームコードを**TypeScript**で書き直し、**Vue 3**でレンダリング、**Vitest**でテスト可能にしたプロジェクト。

Phaserのような大規模フレームワークは**テスト困難**で**過剰機能**。このプロジェクトは**軽量ライブラリの組み合わせ**で、同等の機能を実現しながら**完全なテスト駆動開発**を可能にします。

## ✨ 特徴

- ✅ **TypeScript** - 型安全で保守性の高いコード
- ✅ **Vue 3** - モダンなUIフレームワーク
- ✅ **Vitest** - 高速なテスト駆動開発
- ✅ **軽量** - 必要な機能だけを追加
- ✅ **テスト可能** - ゲームロジックを簡単にテスト

## 🚀 クイックスタート

```bash
# 依存関係をインストール
pnpm install

# 開発サーバーを起動
pnpm dev

# テストを実行
pnpm test

# テストUIを起動
pnpm test:ui
```

## 📦 技術スタック

### コア
- **Vue 3** - UIフレームワーク
- **TypeScript** - 型システム
- **Vite** - ビルドツール

### テスト
- **Vitest** - ユニットテスト
- **jsdom** - DOM環境シミュレーション

### 採用ライブラリ（確定版）

#### 🎵 BGM - MIDI再生
- **Tone.js** + **@tonejs/midi**
  - MIDIファイルをJSON変換して再生
  - Web Audio API ベース
  - `Midi.fromUrl()` でロード → 各ノートをスケジュール

#### 🔊 効果音 - MP3再生
- **Howler.js** (~7KB)
  - シンプルAPI、全ブラウザ対応
  - 代替: AmplitudeJS (依存なし), vlitejs (6KB)

#### 🎨 描画エンジン
- **PixiJS**
  - **Phaserの半分以下のサイズ** (5.8KB vs 12.5KB)
  - Tree-shakable（未使用機能削除可能）
  - 超高速2Dレンダリング特化
  - スプライトシート管理も内蔵

#### 💥 衝突判定（2段階アプローチ）
- **タイルマップ**: 自作（空間グリッド最適化）
  - プレイヤー周辺のタイルだけチェック
  - 座標 ÷ タイルサイズ = チェック範囲
  - ライブラリ不要で超高速

- **動的オブジェクト（プレイヤー vs 敵多数）**:
  1. **Broad Phase**: 空間ハッシュ（自作）で候補絞り
     - 100個 → 5個程度に削減
  2. **Narrow Phase**: **SAT.js** (~2KB gzip) で精密判定
     - AABB前チェックで更に高速化
     - 早期終了・Response再利用で最適化

  **パフォーマンス**: 100オブジェクトで25-50%高速化、1000個で100倍以上!

#### 🎮 入力管理
- **キーボード**: 自作（シンプル）
- **ゲームパッド**: ネイティブGamepad API (0KB)

---

### 📦 最終構成

```
ゲームエンジン（自作・完全テスト可能）
  ├─ Vue 3 + TypeScript
  ├─ Vitest（TDD）
  │
  ├─ PixiJS（描画）       ~6KB
  ├─ Tone.js（BGM/MIDI）  ~30KB
  ├─ Howler.js（効果音）  ~7KB
  └─ 自作（物理・衝突）   軽量

合計追加: ~45KB
vs Phaser: ~1000KB → 約22倍軽量!
```

#### 🎯 自作する部分
- ゲームループ
- エンティティシステム
- 物理演算（重力、速度）
- タイルマップ衝突判定
- 状態管理

## 🎮 元のプロジェクト

JavaScript版: `/wwaction` ディレクトリ

## 📄 ライセンス

ISC
